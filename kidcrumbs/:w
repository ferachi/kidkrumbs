<template>
    <div id="schoolsSlide" class="p-2">
        <div class="d-flex">
            <div class="col-auto" v-for="school in schoolList" :key="school.id">
                {{school.isActive}}
                <avatar :image="school.logo" :alt="school.name" :size="school.isActive ? 'large' : 'normal'" :class="{'fade-elem':!school.isActive}"></avatar>
            </div>
        </div>
    </div>
</template>
<script>
import avatar from '../../../components/avatar.vue';
export default{
    name : 'SchoolsSlide',
    created(){
        this._schools = this.getSchools;
    },
    props : {
        schools :{
            type : Array,
            required : true
        },
        index:{
            type : Number,
            required : true
        },
        speed : {
            type : Number,
            default : 5000
        }
    },
    computed : {
        getSchools(){
            let schools = _.cloneDeep(this.schools);
            schools = _.map( schools , school => {
                school.isActive = false;
                return school;
            });
            schools = _.sortBy(schools, 'name');
            schools[this.index].isActive = true;
            return schools;
        },
        schoolList(){
            console.log(this._schools);
            return _.take(this._schools, 5);
        },
    },
    methods:{
        previous(){
            this.index = this.index == 0 ? this.schools.length - 1 : this.index - 1;
            this.timer();
        },
        next(){
            this.index = this.index + 1 == this.schools.length ? 0 : this.index + 1;
            this.timer();
        },
        timer(){
            this.clearTimer();
            let _timer = setTimeout(() => { this.play(); clearTimeout(_timer); });
        },
        clearTimer(){
            clearInterval(this.timeId);
        },
        play(){
            this.timeId = setInterval( () => {
                this.index = this.index + 1 == this.schools.length ? 0 : this.index + 1;
            },this.speed);
        },
        changeIndex(newVal, oldVal){
            let direction, school ;
            let len = this.getSchools.length - 1;
            if(  (oldVal == len && newVal == 0) || (newVal > oldVal && newVal != len && oldVal!=0)){
                direction = 'right';
            }
            else{
                direction = 'left';
            }

            if(direction == 'right'){
                school = this._schools.shift();
                this._schools.push(school);
                console.log(school);
                console.log(this._schools);
            }
            else{
                school = this._schools.pop();
                this._schools.unshift(school);
                console.log(school);
            }
        }
    },
    data(){
        return{
            playList : [{}],
            timeId : 0,
            _schools:[]
        }
    },
    components : {
        avatar
    },
    watch:{
        getSchools(val){
            this._schools = val;
        },
        index(newVal, oldVal){
            this.changeIndex();
        }
    }
}
</script>
<style lang='stylus'>
#schoolsSlide
    .fade-elem
        opacity 0.3
</style>

